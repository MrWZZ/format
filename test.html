<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
    1
    2
    1
    3
    2
    3
    3
    <script>
        var content = "111111,2--2,11111,3,2--2,3,3";
        var flag = new ContentFlag(content);
        //先处理块状元素
        flag.replace(/1+/g,function(str){
            var str = str.replace(/1/g,"-666-");
            return str;
        });
        flag.replace(/3/g,function(str){
            return "<***>";
        });
        flag.replace(/--/g,function(str){
            return "----";
        });
        flag.replace(/2[\s\S]+?2/g,function(str){
            return `<p>${str}</p>`;
        });
        content = flag.restore();
        console.log(content);
        
        function ContentFlag(content) {
            var self = this;
            self.regexp = /\[~\d+~\]/g;
            self.content = content;
            self.contentList = [];
            self.index = 0;
            self.replace = function(regexp,func) { 
                self.content = self.content.replace(regexp,function(str) {
                    str = str.replace(self.regexp,function(str) {
                        return self.replaceFlag(str);
                    });
                    self.contentList[self.index] = func(str);
                    return `[~${self.index++}~]`; 
                });
                return self.content;
            }
            self.restore = function() { 
                self.content = self.content.replace(self.regexp,self.replaceFlag);
                return self.content;
            }
            self.replaceFlag = function(str) { 
                return self.contentList[Number(str.match(/\d+/)[0])]; 
            }
        }

        
    </script>
</body>
</html>